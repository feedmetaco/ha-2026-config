title: Bambu Printer
icon: mdi:printer-3d
views:
  - title: Control
    path: control
    icon: mdi:printer-3d-nozzle
    cards:
      - type: horizontal-stack
        cards:
          - type: custom:mushroom-template-card
            primary: "{{ states('sensor.print_status')|title }}"
            secondary: "{{ states('sensor.print_progress') }}% - {{ states('sensor.remaining_time') }}m left"
            icon: mdi:printer-3d
            icon_color: >
              {% if states('sensor.print_status') == 'running' %}
                green
              {% elif states('sensor.print_status') == 'pause' %}
                orange
              {% elif states('sensor.print_status') == 'offline' %}
                red
              {% else %}
                blue
              {% endif %}
            multiline_secondary: true
            fill_container: true
            tap_action:
              action: more-info
            entity: sensor.print_status

          - type: custom:mushroom-entity-card
            entity: sensor.bambu_lab_power
            primary_info: state
            secondary_info: name
            name: Power
            icon_color: amber

      - type: picture-entity
        entity: camera.bambu_lab_camera
        name: Live Feed
        show_state: false
        show_name: false
        camera_view: live
        aspect_ratio: 16:9

      - type: grid
        columns: 3
        square: false
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.nozzle_temp
            primary_info: state
            secondary_info: name
            name: Nozzle
            icon: mdi:printer-3d-nozzle
            icon_color: red
          - type: custom:mushroom-entity-card
            entity: sensor.bed_temp
            primary_info: state
            secondary_info: name
            name: Bed
            icon: mdi:radiator
            icon_color: orange
          - type: custom:mushroom-entity-card
            entity: sensor.chamber_temp
            primary_info: state
            secondary_info: name
            name: Chamber
            icon: mdi:thermometer
            icon_color: green

      - type: grid
        columns: 4
        square: true
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.tray_1
            name: Slot 1
            layout: vertical
            primary_info: state
            secondary_info: none
            icon: mdi:circle
          - type: custom:mushroom-entity-card
            entity: sensor.tray_2
            name: Slot 2
            layout: vertical
            primary_info: state
            secondary_info: none
            icon: mdi:circle
          - type: custom:mushroom-entity-card
            entity: sensor.tray_3
            name: Slot 3
            layout: vertical
            primary_info: state
            secondary_info: none
            icon: mdi:circle
          - type: custom:mushroom-entity-card
            entity: sensor.tray_4
            name: Slot 4
            layout: vertical
            primary_info: state
            secondary_info: none
            icon: mdi:circle

      - type: horizontal-stack
        cards:
          - type: button
            name: Pause
            icon: mdi:pause
            tap_action:
              action: call-service
              service: button.press
              target:
                entity_id: button.bambu_lab_pause
          - type: button
            name: Resume
            icon: mdi:play
            tap_action:
              action: call-service
              service: button.press
              target:
                entity_id: button.bambu_lab_resume
          - type: button
            name: Stop
            icon: mdi:stop
            tap_action:
              action: call-service
              service: button.press
              target:
                entity_id: button.bambu_lab_stop

  - title: Analytics
    path: analytics
    icon: mdi:chart-line
    cards:
      # Live Status Header - Compact
      - type: horizontal-stack
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.print_status
            name: Status
            icon: mdi:printer-3d
            primary_info: state
            fill_container: true

          - type: custom:mushroom-entity-card
            entity: sensor.bambu_lab_power
            name: Power Now
            icon: mdi:flash
            icon_color: amber
            primary_info: state
            fill_container: true

          - type: custom:mushroom-entity-card
            entity: sensor.bambu_lab_cost_rate
            name: Cost Rate
            icon: mdi:currency-usd
            icon_color: green
            primary_info: state
            fill_container: true

          - type: custom:mushroom-entity-card
            entity: sensor.bambu_lab_current_print_cost
            name: This Print
            icon: mdi:currency-usd-circle
            icon_color: blue
            primary_info: state
            fill_container: true

      # CHART 1: Power Usage History (24 Hours)
      - type: custom:apexcharts-card
        header:
          show: true
          title: "‚ö° Power Usage - Last 24 Hours"
          show_states: true
        graph_span: 24h
        update_interval: 30s
        span:
          start: day
        series:
          - entity: sensor.bambu_lab_power
            name: Power Draw
            stroke_width: 3
            type: line
            curve: smooth
            color: "#ffc107"
            opacity: 1
            show:
              legend_value: true
          - entity: sensor.print_progress
            name: Print Progress
            stroke_width: 2
            type: area
            curve: stepline
            color: "#2196f3"
            opacity: 0.2
            yaxis_id: progress
        yaxis:
          - id: power
            min: 0
            max: ~300
            apex_config:
              title:
                text: "Power (W)"
              labels:
                formatter: |
                  EVAL:function(val) { return val.toFixed(0) + ' W'; }
          - id: progress
            opposite: true
            min: 0
            max: 100
            apex_config:
              title:
                text: "Progress (%)"
        apex_config:
          annotations:
            yaxis:
              - y: 250
                borderColor: "#ff9800"
                label:
                  text: "Heating Phase"
                  style:
                    color: "#fff"
                    background: "#ff9800"
              - y: 150
                borderColor: "#4caf50"
                label:
                  text: "Active Printing"
                  style:
                    color: "#fff"
                    background: "#4caf50"

      # CHART 2: Energy Consumption (7 Days) - Cumulative
      - type: custom:apexcharts-card
        header:
          show: true
          title: "üìä Energy Consumption - Last 7 Days"
        graph_span: 7d
        span:
          start: week
        series:
          - entity: sensor.bambu_lab_energy
            name: Cumulative Energy
            stroke_width: 3
            type: area
            curve: smooth
            color: "#4caf50"
            opacity: 0.3
            show:
              in_header: true
              legend_value: true
        apex_config:
          yaxis:
            labels:
              formatter: |
                EVAL:function(val) { return val.toFixed(2) + ' kWh'; }
          chart:
            height: 280px

      # CHART 3: Cost Analysis (30 Days) - Daily Bars + Cumulative Line
      - type: custom:apexcharts-card
        header:
          show: true
          title: "üí∞ Cost Analysis - Last 30 Days"
        graph_span: 30d
        span:
          start: month
        series:
          - entity: sensor.bambu_lab_cost_today
            name: Daily Cost
            type: column
            color: "#2196f3"
            opacity: 0.6
            group_by:
              func: last
              duration: 1d
          - entity: sensor.bambu_lab_cost_this_month
            name: Monthly Total
            stroke_width: 3
            type: line
            curve: smooth
            color: "#f44336"
            opacity: 1
        apex_config:
          yaxis:
            labels:
              formatter: |
                EVAL:function(val) { return '$' + val.toFixed(2); }
          chart:
            height: 300px

      # CHART 4: Print Efficiency - Runtime vs Cost
      - type: custom:apexcharts-card
        header:
          show: true
          title: "üìà Print Efficiency - Runtime vs Energy"
        graph_span: 7d
        series:
          - entity: sensor.bambu_lab_printing_today
            name: Daily Runtime
            type: column
            color: "#9c27b0"
            opacity: 0.6
            group_by:
              func: last
              duration: 1d
          - entity: sensor.bambu_lab_energy_daily
            name: Daily Energy
            type: line
            stroke_width: 3
            color: "#ffc107"
            yaxis_id: energy
        yaxis:
          - id: runtime
            apex_config:
              title:
                text: "Runtime (hours)"
          - id: energy
            opposite: true
            apex_config:
              title:
                text: "Energy (kWh)"

      # CHAART 5: Temperature Correlation
      - type: custom:apexcharts-card
        header:
          show: true
          title: "üå°Ô∏è Temperature & Power Correlation - Last 12 Hours"
        graph_span: 12h
        series:
          - entity: sensor.nozzle_temp
            name: Nozzle Temp
            stroke_width: 2
            type: line
            curve: smooth
            color: "#f44336"
            show:
              legend_value: true
          - entity: sensor.bed_temp
            name: Bed Temp
            stroke_width: 2
            type: line
            curve: smooth
            color: "#ff9800"
            show:
              legend_value: true
          - entity: sensor.chamber_temp
            name: Chamber Temp
            stroke_width: 2
            type: line
            curve: smooth
            color: "#4caf50"
            show:
              legend_value: true
          - entity: sensor.bambu_lab_power
            name: Power Draw
            stroke_width: 3
            type: area
            curve: smooth
            color: "#ffc107"
            opacity: 0.2
            yaxis_id: power
            show:
              legend_value: true
        yaxis:
          - id: temp
            apex_config:
              title:
                text: "Temperature (¬∞C)"
          - id: power
            opposite: true
            min: 0
            max: ~300
            apex_config:
              title:
                text: "Power (W)"

      # Cost Statistics Grid
      - type: custom:grid-layout
        layout:
          grid-template-columns: repeat(4, 1fr)
          gap: 12px
        cards:
          - type: statistic
            entity: sensor.bambu_lab_cost_today
            name: Today
            icon: mdi:calendar-today

          - type: statistic
            entity: sensor.bambu_lab_cost_this_week
            name: This Week
            icon: mdi:calendar-week

          - type: statistic
            entity: sensor.bambu_lab_cost_this_month
            name: This Month
            icon: mdi:calendar-month

          - type: statistic
            entity: sensor.bambu_lab_projected_monthly_cost
            name: Projected
            icon: mdi:chart-line-variant

      # Runtime & Efficiency Stats
      - type: custom:grid-layout
        layout:
          grid-template-columns: repeat(3, 1fr)
          gap: 12px
        cards:
          - type: statistic
            entity: sensor.bambu_lab_printing_today
            name: Print Time Today
            icon: mdi:clock-time-eight

          - type: statistic
            entity: sensor.bambu_lab_printing_this_week
            name: Print Time Week
            icon: mdi:calendar-week

          - type: statistic
            entity: sensor.total_usage_hours
            name: Total Runtime
            icon: mdi:timer
